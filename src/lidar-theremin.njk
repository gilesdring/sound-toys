---
layout: layouts/base.njk
title: Lidar Theremin
---
<style>
  main > * + * {
    margin-top: 1em;
  }
  .no-top-margin * + * {
    margin-top: 0;
  }

  #image {
    position: relative;
  }
  .overlay {
    position: absolute;
    top: 0;
    left: 0;
  }
  #control {
    display: flex;
    gap: 1rem;
  }
  fieldset {
    padding: 1rem;
  }
  fieldset > * + * {
    margin-top: 0.5rem;
  }
  fieldset > div:first-of-type {
    margin-top: 0;
  }
</style>

<main role="main">
  <div id="control">
    <fieldset id="mode-selector">
      <legend for="mode-selector">Mode:</legend>
      <div>
        <input type="radio" id="play-mode" name="mode" value="play"></input>
        <label for="play-mode">Play the landscape</label>
      </div>
      <div>
        <input type="radio" id="sample-mode" name="mode" value="sample"></input>
        <label for="sample-mode">Sample the landscape</label>
      </div>
    </fieldset>
    <fieldset id="play-params">
      <legend>Play settings:</legend>
      <div>
        <input type="checkbox" id="play-sticky" name="sticky"></input>
        <label for="play-sticky">Keep the note on</label>
      </div>
    </fieldset>
  </div>
  <div id="image"class="pane no-top-margin">
  </div>
  <div id="visualisation" class="no-top-margin">
    <canvas id="waveform"></canvas>
    <canvas id="oscilloscope"></canvas>
  </div>
</main>

<script src="/assets/js/lidar-theremin.js"></script>
<script>
  addEventListener('DOMContentLoaded', () => {
    const app = new soundToys.LidarTheremin({
      image: '{{ "/assets/images/LIDAR-DTM-2M-SD84sw.png" | url }}',
      imageId: 'image',
    });

    document.querySelector('#mode-selector').addEventListener('change', (e) => {
      const mode = e.target.value;
      switch (mode) {
        case 'play':
          app.setPlayMode();
          break;;
        case 'sample':
          app.setSamplingMode();
          break;;
        default:
          console.warning(`Unkown mode: ${mode}`);
          break;;
      }
    })

    document.querySelector('#play-sticky').addEventListener('change', (e) => {
      if (e.target.checked) {
        app.setStickyModeOn();
      } else {
        app.setStickyModeOff();
      }
    })

    // Set default mode
    document.querySelector('#mode-selector #play-mode').checked = true;
    document.querySelector('#play-sticky').checked = false

    soundToys.setupVisualisers({
      wave: 'waveform',
      scope: "oscilloscope",
      analyser: app.synth.getAnalyser(),
    });
  })
</script>
